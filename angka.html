<!DOCTYPE html>
<html>

<head>
  <title>INPUT DATA KE SPREAD SHEET</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* CSS Styling */
    body {
      background-color: #e2f1dd;
      font-family: sans-serif;
    }
    #form-container {
      width: 350px;
      margin: 0 auto;
      background-color: #f1f1f7;
      border: 2px solid #da0808;
      border-radius: 10px;
      padding: 20px;
    }
    #form-container h2 {
      text-align: center;
      color: #1E90FF;
    }
    /* Grouping styles for all visible inputs */
    #form-container input[type="text"], 
    #form-container input[type="date"], 
    #form-container input[type="tel"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border: 2px solid #f1d0d0;
      border-radius: 5px;
      box-sizing: border-box;
    }
    
    /* Gaya spesifik untuk input uang yang sekarang bertipe text */
    .input-uang {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border: 2px solid #f1d0d0;
      border-radius: 5px;
      box-sizing: border-box;
    }
    
    /* Gaya untuk input yang dinonaktifkan (disabled) */
    .input-uang:disabled {
        background-color: #e9e9e9;
        cursor: not-allowed;
    }

    #form-container input[type="submit"] {
      background-color: #1E90FF;
      color: #FFFFFF;
      border: none;
      border-radius: 5px;
      padding: 10px;
      cursor: pointer;
      width: 100%;
    }
    #form-container input[type="submit"]:hover {
      background-color: #004B8D;
    }
    #footer {
      text-align: center;
      margin-top: 30px;
      font-size: 12px;
      color: #777;
    }
  </style>
</head>

<body>
  <div id="form-container">
    <h2>INPUT DATA KE SPREAD SHEET</h2>
    
    <!-- Menambahkan id="dataForm" ke formulir untuk akses JavaScript -->
    <form id="dataForm" action="https://script.google.com/macros/s/AKfycbyfojwuPU8NQqe2SLsGNwTwG80BlDTOI-lNTxxB0kC_8vh93ukvL0P10jdLlEvNIH9S/exec" method="post">

    <label for="tgl_tr">Tanggal Transaksi:</label>
    <input type="date" id="tgl_tr" name="tgl_tr" required>
    
    <label for="uraian">Keterangan Transaksi:</label>
    <input type="text" id="uraian" name="uraian" required>
    
    <label for="masuk">Uang Masuk:</label>
    <input type="text" id="masuk" class="input-uang" oninput="formatAndToggle(this, 'masuk')">
    <!-- Input tersembunyi untuk mengirim nilai angka MURNI ke Apps Script -->
    <input type="hidden" id="hidden_masuk" name="masuk">
    
    <label for="keluar">Uang Keluar:</label>
    <input type="text" id="keluar" class="input-uang" oninput="formatAndToggle(this, 'keluar')">
     <!-- Input tersembunyi untuk mengirim nilai angka MURNI ke Apps Script -->
    <input type="hidden" id="hidden_keluar" name="keluar">
    
    <input type="submit" value="Simpan Data">
    </form>
  </div>

  <div id="footer">
    All Tutorial for you, jangan lupa subcribe karna akan selalu ada update
  </div>

  <script type="text/javascript">

    /* Fungsi untuk membersihkan string Rupiah menjadi angka murni */
    function cleanRupiah(rupiahString) {
        // Menghilangkan 'Rp.', titik (ribuan), dan mengubah koma desimal menjadi titik desimal (standar JS/Apps Script)
        let clean = rupiahString.replace(/Rp\.?\s?|[^0-9,]+/g, '').replace(',', '.');
        // Mengembalikan sebagai angka (float)
        return parseFloat(clean) || 0; 
    }

    /* Fungsi untuk memformat angka menjadi format Rupiah (Rp. 1.000.000) untuk tampilan UI */
    function formatRupiah(angka) {
      var number_string = angka.replace(/[^,\d]/g, '').toString(),
          split = number_string.split(','),
          sisa = split[0].length % 3,
          rupiah = split[0].substr(0, sisa),
          ribuan = split[0].substr(sisa).match(/\d{3}/gi);

      if (ribuan) {
          separator = sisa ? '.' : '';
          rupiah += separator + ribuan.join('.');
      }

      rupiah = split[1] != undefined ? rupiah + ',' + split[1] : rupiah;
      return rupiah ? 'Rp. ' + rupiah : '';
    }

    /* Fungsi gabungan untuk format mata uang DAN toggle input disable/enable */
    function formatAndToggle(inputElement, inputType) {
      // 1. Format tampilan UI
      inputElement.value = formatRupiah(inputElement.value);

      // 2. Logika toggle disable/enable
      const inputMasuk = document.getElementById('masuk');
      const inputKeluar = document.getElementById('keluar');
      
      // Cek nilai murni untuk logika toggle
      const nilaiMasuk = cleanRupiah(inputMasuk.value);
      const nilaiKeluar = cleanRupiah(inputKeluar.value);

      if (inputType === 'masuk') {
        if (nilaiMasuk > 0) {
          inputKeluar.disabled = true;
          inputMasuk.required = true;
          inputKeluar.required = false;
        } else {
          inputKeluar.disabled = false;
          inputMasuk.required = false;
        }
      } else if (inputType === 'keluar') {
        if (nilaiKeluar > 0) {
          inputMasuk.disabled = true;
          inputKeluar.required = true;
          inputMasuk.required = false;
        } else {
          inputMasuk.disabled = false;
          inputKeluar.required = false;
        }
      }
    }

    // --- Fungsi yang berjalan tepat SEBELUM formulir dikirim ---
    document.getElementById('dataForm').addEventListener('submit', function(event) {
      // Ambil nilai tampilan yang sudah diformat dari input terlihat
      const displayMasuk = document.getElementById('masuk').value;
      const displayKeluar = document.getElementById('keluar').value;

      // Konversi ke angka murni dan masukkan ke input hidden
      document.getElementById('hidden_masuk').value = cleanRupiah(displayMasuk);
      document.getElementById('hidden_keluar').value = cleanRupiah(displayKeluar);
      
      // Data yang dikirim ke Google Apps Script sekarang adalah angka murni!
    });
    
    // Pastikan input dinonaktifkan saat halaman dimuat pertama kali
    document.addEventListener('DOMContentLoaded', (event) => {
        // Aktifkan input secara default saat load, user yang akan menonaktifkan pasangannya saat mengisi
        document.getElementById('masuk').disabled = false; 
        document.getElementById('keluar').disabled = false;
    });
  </script>
</body>
</html>
